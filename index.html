<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fact-Check Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .loader {
            border-top-color: #3498db;
            -webkit-animation: spin 1s linear infinite;
            animation: spin 1s linear infinite;
        }
        @-webkit-keyframes spin {
            0% { -webkit-transform: rotate(0deg); }
            100% { -webkit-transform: rotate(360deg); }
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">
    <div class="container mx-auto px-4 py-8 md:py-12">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">AI Fact-Check & Plagiarism Detector</h1>
            <p class="text-md text-gray-600 mt-2">Enter text below to verify its authenticity and find original sources.</p>
        </header>

        <main class="bg-white rounded-lg shadow-md p-6 md:p-8 max-w-4xl mx-auto">
            <div class="mb-6">
                <label for="text-input" class="block text-lg font-medium text-gray-700 mb-2">Your Text</label>
                <textarea id="text-input" rows="8" class="w-full p-4 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out" placeholder="Paste or type the text you want to check here..."></textarea>
            </div>

            <div class="flex justify-center">
                <button id="fact-check-btn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition duration-300 ease-in-out flex items-center">
                    <svg id="button-icon" class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                    <span id="button-text">Fact-Check</span>
                </button>
            </div>

             <!-- Loading Indicator -->
            <div id="loader" class="hidden flex justify-center items-center my-6">
                <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12"></div>
                <p class="ml-4 text-gray-600">Analyzing text...</p>
            </div>

             <!-- Error Message -->
            <div id="error-message" class="hidden mt-6 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg relative" role="alert">
                <strong class="font-bold">Error:</strong>
                <span class="block sm:inline" id="error-text"></span>
            </div>

            <div id="results-container" class="mt-8 hidden">
                <!-- Verified Content Section -->
                <div id="verified-content" class="mb-8">
                    <h2 class="text-2xl font-semibold text-gray-900 border-b-2 border-gray-200 pb-2 mb-4">Verified Content</h2>
                    <div id="verified-text" class="bg-gray-50 p-4 rounded-md text-gray-800 whitespace-pre-wrap"></div>
                </div>

                <!-- Sources Section -->
                <div id="sources-content">
                    <h2 class="text-2xl font-semibold text-gray-900 border-b-2 border-gray-200 pb-2 mb-4">Detected Sources</h2>
                    <div id="sources-list" class="space-y-3">
                         <!-- Sources will be dynamically inserted here -->
                    </div>
                </div>
            </div>
        </main>
         <footer class="text-center mt-12">
            <p class="text-gray-500">Powered by Gemini</p>
        </footer>
    </div>

    <script>
        const textInput = document.getElementById('text-input');
        const factCheckBtn = document.getElementById('fact-check-btn');
        const buttonText = document.getElementById('button-text');
        const buttonIcon = document.getElementById('button-icon');
        const loader = document.getElementById('loader');
        const resultsContainer = document.getElementById('results-container');
        const verifiedText = document.getElementById('verified-text');
        const sourcesList = document.getElementById('sources-list');
        const errorMessage = document.getElementById('error-message');
        const errorText = document.getElementById('error-text');

        // Main function to handle the fact-checking process
        factCheckBtn.addEventListener('click', async () => {
            const userQuery = textInput.value.trim();
            if (!userQuery) {
                showError("Please enter some text to check.");
                return;
            }

            setLoading(true);
            hideError();
            resultsContainer.classList.add('hidden');

            try {
                // The API call is a simplified example.
                const { text, sources } = await callGeminiApi(userQuery);

                if (text) {
                    verifiedText.textContent = text;
                    displaySources(sources);
                    resultsContainer.classList.remove('hidden');
                } else {
                     showError("Could not retrieve verified content. The model may have returned an empty response.");
                }

            } catch (error) {
                console.error('API Call failed:', error);
                showError(`An error occurred: ${error.message}. Please check the console for more details.`);
            } finally {
                setLoading(false);
            }
        });

        /**
         * Simulates calling the Gemini API with exponential backoff.
         * In a real application, you would replace this with a `fetch` call.
         */
        async function callGeminiApi(userQuery) {
            const apiKey = ""; // API key is handled by the environment, leave empty.
            const apiUrl = `https://generativelaunguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            const systemPrompt = "You are a helpful fact-checking assistant. Analyze the user's text. If it's accurate, return the text as is. If there are inaccuracies, correct them while preserving the original intent. Provide sources that support your verification.";

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                tools: [{ "google_search": {} }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
            };

            let response;
            let attempts = 0;
            const maxAttempts = 5;
            let delay = 1000; // Start with 1 second

            while (attempts < maxAttempts) {
                try {
                    response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.ok) {
                        const result = await response.json();
                        const candidate = result.candidates?.[0];

                        if (candidate && candidate.content?.parts?.[0]?.text) {
                            const text = candidate.content.parts[0].text;
                            let sources = [];
                            const groundingMetadata = candidate.groundingMetadata;

                            if (groundingMetadata && groundingMetadata.groundingAttributions) {
                                sources = groundingMetadata.groundingAttributions
                                    .map(attribution => ({
                                        uri: attribution.web?.uri,
                                        title: attribution.web?.title,
                                    }))
                                    .filter(source => source.uri && source.title);
                            }
                             return { text, sources };
                        } else {
                           // If the response is OK but content is missing, we'll let the outer catch handle it after retries.
                           throw new Error("Invalid response structure from API.");
                        }
                    } else if (response.status === 429 || response.status >= 500) {
                        // Throttling or server error, so we retry
                        throw new Error(`API error with status ${response.status}`);
                    } else {
                        // Client-side error that shouldn't be retried
                        const errorData = await response.json();
                        throw new Error(errorData.error?.message || `HTTP error! status: ${response.status}`);
                    }
                } catch (error) {
                    attempts++;
                    if (attempts >= maxAttempts) {
                       throw error;
                    }
                    await new Promise(resolve => setTimeout(resolve, delay));
                    delay *= 2; // Exponential backoff
                }
            }
             throw new Error("API request failed after multiple retries.");
        }

        // Function to display the sources
        function displaySources(sources) {
            sourcesList.innerHTML = ''; // Clear previous sources
            if (sources && sources.length > 0) {
                sources.forEach((source, index) => {
                    const sourceElement = document.createElement('div');
                    sourceElement.classList.add('bg-white', 'p-4', 'rounded-lg', 'border', 'border-gray-200', 'hover:shadow-md', 'transition-shadow');
                    sourceElement.innerHTML = `
                        <a href="${source.uri}" target="_blank" rel="noopener noreferrer" class="flex items-center space-x-3">
                            <span class="flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center font-bold text-sm">${index + 1}</span>
                            <div class="flex-grow">
                                <p class="font-semibold text-blue-700 hover:underline">${source.title || 'Untitled Source'}</p>
                                <p class="text-sm text-gray-500 truncate">${source.uri}</p>
                            </div>
                            <svg class="w-5 h-5 text-gray-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                        </a>
                    `;
                    sourcesList.appendChild(sourceElement);
                });
            } else {
                sourcesList.innerHTML = '<p class="text-gray-500">No sources were found for this text.</p>';
            }
        }

        // UI state management functions
        function setLoading(isLoading) {
             if (isLoading) {
                loader.classList.remove('hidden');
                factCheckBtn.disabled = true;
                buttonText.textContent = 'Checking...';
                buttonIcon.classList.add('hidden');
            } else {
                loader.classList.add('hidden');
                factCheckBtn.disabled = false;
                buttonText.textContent = 'Fact-Check';
                buttonIcon.classList.remove('hidden');
            }
        }

        function showError(message) {
            errorText.textContent = message;
            errorMessage.classList.remove('hidden');
        }

        function hideError() {
            errorMessage.classList.add('hidden');
        }
    </script>
</body>
</html>
